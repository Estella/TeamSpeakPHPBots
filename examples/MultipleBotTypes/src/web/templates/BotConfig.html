<!--INCLUDE:Head.html-->
<script>
	
	function initContent() {
		$("#backbtnId").show();
		setupBotLists("BotConfigGB", "tableGreetingBotId");
		setupBotLists("BotConfigCB", "tableChatBotId");
	}

	function setupBotLists(botType, tableId) {
		REST.getBotList(botType, function (res) {
			if (res.result === "ok") {
				LAYOUT.putBotList(botType, tableId, res.data, function (op, botType, id) {
					switch(op) {
						case "delete":
							botDelete(botType, id);
							break;
						case "modify":
							botModify(botType, id);
							break;
						case "enableBot":
							botEnable(botType, id, true);
							break;
						case "disableBot":
							botEnable(botType, id, false);
							break;
						default:
							;
					}
				});
			}
		});
	}

	function processBotCreate(botType) {
		REST.createBot(botType, "botFormId", function(res) {
			if (res.result === "ok") {
				showMessageDialog("New Bot", "Bot was successfully created.", "Ok",  function() {
					location.reload();				
				});
			}
			else {
				showMessageDialog("New Bot", "Bot could not be created!\nReason: " + res.reason, "Ok",  function() {
					location.reload();				
				});
			}
		});
	}

	function processBotModify(botType, id) {
		REST.updateBot(botType, id, "botFormId", function(res) {
			if (res.result === "ok") {
				showMessageDialog("Bot Configuration", "Bot was successfully updated.", "Ok",  function() {
					location.reload();				
				});
				notifyServiceBotUpdate(id);
			}
			else {
				showMessageDialog("Bot Configuration", "Bot could not be updated!\nReason: " + res.reason, "Ok",  function() {
					location.reload();				
				});
			}
		});
	}

	function onBodyClicked(event) {
		if ($("#menuDropdownId").is( ":visible" )) {
			$("#menuDropdownId").toggle("slide");
		}
		event.stopPropagation();
	}

	function botNew(botType) {
		$("#dialogBotId").show();
		var dlg = $("#dialogBotId").dialog({
			dialogClass: "no-close",
			draggable: false,
			autoOpen: false,
			resizable: false,
			width: 370,
			modal: true,
			buttons:{
				"Cancel": function(event) {
					$(this).dialog( "close" );
				},
				"Create": function(event) {
					processBotCreate(botType);
				}
			}
		});
		dlg.find("form").on("submit", function(event) {
			event.preventDefault();
			processBotCreate(botType);
		});
		dlg.dialog("open");
		dlg.dialog("moveToTop");
	}

	function botModify(botType, id) {
		REST.getBot(botType, id, function(res) {
			if (res.result === "ok") {
				// fill the form inputs
				$.each(res.data, function(field, value) {
					$('#botFormId :input[name="' + field + '"]').val(value);
				});
				$("#dialogBotId").show();
				var dlg = $("#dialogBotId").dialog({
					dialogClass: "no-close",
					draggable: false,
					autoOpen: false,
					resizable: false,
					width: 370,
					modal: true,
					buttons:{
						"Cancel": function(event) {
							$(this).dialog( "close" );
						},
						"Apply": function(event) {
							$(this).dialog( "close" );
							processBotModify(botType, res.data.id);
						}
					}
				});
				dlg.find("form").on("submit", function(event) {
					event.preventDefault();
					processBotModify(botType, res.data.id);
				});
				dlg.dialog("open");
				dlg.dialog("moveToTop");
			}
			else {
				showMessageDialog("Modify Bot", "Bot could not be found!\nReason: " + res.reason, "Ok", null);
			}
		});
	}

	function botDelete(botType, id) {
		showMessageDialog("Delete Bot", "Do you really want to delete the bot?",
		"No", null,
		"Yes", function() {
			REST.deleteBot(botType, id, function (res) {
				if (res.result === "ok") {
					showMessageDialog("Delete Bot", "Bot was successfully deleted.", "Ok", function() {
						location.reload();				
					});
				}
				else {
					showMessageDialog("Delete Bot", "Bot could not be deleted.\nReason: " + res.reason, "Ok", null);
				}
			});
		});
	}

	function notifyServiceBotUpdate(id) {
		REST.botServiceUpdateBot(id, function(res) {
		});
	}

	function botEnable(botType, id, enable) {
		REST.enableBot(botType, id, enable, function (res) {
			if (res.result === "ok") {
				setTimeout(function() {
					notifyServiceBotUpdate(id);
				}, 500);
			}
			else {
				showMessageDialog("Bot Activation", "Bot activation state could not be changed.\nReason: " + res.reason, "Ok", null);
				location.reload();				
			}
		});
	}
</script>
<div id="maincontentId" class="maincontent">
	<div class="contentbots">
		<table id="tableGreetingBotId" class="tablebots">
			<tr>
				<td class="head">Greeting Bots</td>
				<td class="head"></td>
				<td class="head"></td>
				<td class="head status" style="width:70px; text-align: center;"><img class="imgClickable" src="<!--dirImages-->/bot_add.png" alt="Neuer Bot" title="Neuer Bot" onclick="botNew();"></td>
				<td class="head" style="width: 40px;"></td>
			</tr>
			<tr>
				<th>Name</th>
				<th>Type</th>
				<th>Description</th>
				<th style="text-align: center;">Aktive</th>
				<td class="mods"></td>
			</tr>
		</table>
	</div>
	<div id="dialogGreetingBotId" title="Bot" style="display: none; max-width: 600px;" class="inputDialog">
		<form id="greetintBotFormId">
			<p>Name</p>
			<input type="text" name="name" value="Neuer Bot">
			<p>Description</p>
			<input type="text" name="description" value="">
			<p>Greeting Text</p>
			<input type="text" name="greetingText" value="">
			<input type="submit" tabindex="-1" style="display: none;">
		</form>
	</div>

	<div class="contentbots">
		<table id="tableChatBotId" class="tablebots">
			<tr>
				<td class="head">Chat Bots</td>
				<td class="head"></td>
				<td class="head"></td>
				<td class="head status" style="width:70px; text-align: center;"><img class="imgClickable" src="<!--dirImages-->/bot_add.png" alt="Neuer Bot" title="Neuer Bot" onclick="botNew();"></td>
				<td class="head" style="width: 40px;"></td>
			</tr>
			<tr>
				<th>Name</th>
				<th>Type</th>
				<th>Description</th>
				<th style="text-align: center;">Aktive</th>
				<td class="mods"></td>
			</tr>
		</table>
	</div>
	<div id="dialogChatBotId" title="Bot" style="display: none; max-width: 600px;" class="inputDialog">
		<form id="chatBotFormId">
			<p>Name</p>
			<input type="text" name="name" value="Neuer Bot">
			<p>Description</p>
			<input type="text" name="description" value="">
			<p>Greeting Text</p>
			<input type="text" name="nickName" value="">
			<input type="submit" tabindex="-1" style="display: none;">
		</form>
	</div>
</div>	
<!--INCLUDE:Footer.html-->
